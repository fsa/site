---
layout: post
title: Настройка Wi-Fi в Gentoo
date: 12.10.2013 01:49:00 +0500
tags: [Gentoo, Wi-Fi]
excerpt: Опыт настройки Wi-Fi в операционной системе Gentoo без использования NetworkManager
---
На удивление быстро настроился Wi-Fi на Gentoo. Поскольку заметка написана уже после настройки Wi-Fi, то могут быть неточности. Замечания и полезные комментарии приветствуются. Если будет необходимо, заметка будет доработана.

По некоторым соображениям я не люблю NetworkManager, поэтому настройку сети предпочитаю делать через конфигурационные файлы и командную строку.

Что нам понадобится для настройки:

- поддержка нашего адаптера в ядре;
- опция в ядре для поддержки iw

    ```console
    [*] Networking support --->
    -*- Wireless --->
    cfg80211 wireless extensions compatibility
    ```

- пакет net-wireless/iw;
- пакет net-wireless/wpa_supplicant для подключения к точкам доступа с WPA (по мне так дико настраивать точки доступа иначе).

Будем считать, что ядро вы уже собрали так, как нужно и по ifconfig или ip addr мы получаем в списке адаптеров наш wlan0 или wlp3s0. Установим необходимые пакеты.

Проверим работоспособность нашего Wi-Fi:

```bash
iw list
```

В ответ вы должны получить список доступных точек доступа. Если выдаются ошибки, то дальнейшие действия вам не помогут. Если вы в списке не нашли вашей точки доступа, то проверьте, что она расположена на каналах с 1 по 11. У меня ранее были проблемы при использовании 13 канала!

Настроим сеть с помощью редактирования `/etc/conf.d/net`:

```ini
modules_wlp3s0="wpa_supplicant" # Будем использовать WPA.
wpa_supplicant_wlp3s0="-Dnl80211" # Загрузим соответствующий модуль.
config_wlp3s0="dhcp" # Адрес будем получать автоматически.
```

Если желаете, то можете вместо dhcpd использовать статический IP адрес и другие опции, которые можно найти в документации Gentoo по настройке сети.

Создадим конфигурацию для подключения к нашей точке доступа. Для этого создадим или отредактируем файл `/etc/wpa_supplicant/wpa_supplicant.conf`:

```ini
ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=wheel
update_config=1

###### собственно конфигурация ######

network={
 priority=1
 ssid="port66"
 mode=0
 key_mgmt=WPA-PSK
 psk="WPA_PASSWORD"
}
```

`WPA_PASSWORD` - это ничто иное, как пароль к точке доступа. Секций network может быть несколько - по одной для каждой точки доступа.

Собственно, теперь, после перезапуска системы вы можете получить доступ к беспроводной сети.

Множество полезной информации по настройке Wi-Fi можно найти на сайте <http://wireless.kernel.org/>.

## Решение проблем

Столкнулся с проблемой настройки Wi-Fi на ноутбуке Compaq C6510b. Во-первых, Wi-Fi упорно не хотел включаться кнопкой, только выключался. Решить эту проблему помогли пара опций в ядре: `CONFIG_ACPI_WMI` и `CONFIG_HP_WMI`. Вместо второй вам возможно потребуется другая опция. Для этого поищите я опциях ядра WMI и найдите нужную опцию конкретно для вашей беспроводной сетевой платы.

Второй проблемой была жёсткая блокировка Wi-Fi. `rfkill list` упорно выдавал `Hard blocked: yes`. По идее этой блокировкой управляет кнопка включения/выключения Wi-Fi. Но не смотря ни на что, блокировка была. Решить эту проблему оказалось не просто, а очень просто: достаточно выдернуть кабель из порта Ethernet. Блокировка снята! Если же вам всё-таки нужно использовать одновременно Wi-Fi и Ethernet, то нужно зайти в BIOS Setup и отключить опцию переключения LAN/WLAN. Что характерно, при включении этого переключателя, при блокировке Wi-Fi индикатор не гаснет, что и сбивает с толку. Просто этот индикатор на данном ноутбуке сдвоенный и отображает активность обоих беспроводных интерфейсов: Wi-Fi и Bluetooth.
