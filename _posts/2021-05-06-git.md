---
layout: post
title: Git
date: 2021-05-06 02:12:45 +0700
tags: [Git]
---
Это небольшая шпаргалка по git.

## Конфигурация Git

Для настройки git используется команда `git config`. Конфигурация задаётся на 3 уровнях: уровне системы `--system`, уровне пользователя `--global` и непосредственно в репозитории. Например, указание ключа `--global` означает, что параметры будут сохранены в домашнем каталоге пользователя и будут использованы для всех его репозиториев (`~/.gitconfig` или `~/.config/git/config`). По умолчанию используется ключ `--local`, при этом все настройки сохраняются в файле `.git/config` текущего репозитория. Конфигурация на каждом последующем уровне имеет более высокий приоритет, т.е. настройки внутри репозитория перекрывают настройки в домашнем каталоге пользователя, которые перекрывают системные настройки.

Изначально необходимо задать имя пользователя и адрес электронной почты, которые будут указаны в коммитах. Чтобы не указывать это каждый раз, следует добавить их глобально:

```bash
git config --global user.name "FSA"
git config --global user.email fsa@mail.com
```

В некоторых случаях в качестве дефолтного значения обычно предлагают `текущий_пользователь@имя_хоста`.

Просмотр конфигурации git, локальной и глобальной:

```bash
git config --list
git config --list --global
```

Подробнее о параметрах конфигурации:

```bash
git help config
```

Удалить значение параметров конфигурации или даже целые секции можно так:

```bash
git config unset user.name
git config --remove-section user
```

### Полезные опции

Текстовый редактор, который будет вызван при создании коммитов.

```bash
git config --global core.editor vim
```

Постраничный вывод результатов команд:

```bash
git config --global core.pager 'less -RFX'
```

Свои утилиты для просмотра изменений в файлах:

```bash
git config --global diff.tool kdiff3
git config --global merge.tool kdiff3
```

### Алиасы

Добавление алиасов для часто используемых команд:

```bash
git config --global alias.ci commit
git config --global alias.br branch
git config --global alias.co checkout
git config --global alias.st "status --short"
git config --global alias.hist "log --pretty=format:'%h %ad | %s%d [%an]' --graph --date=short"
```

## Работа с ветками

Просмотр имеющихся веток и всех веток, в том числе в удалённых репозиториях:

```bash
git branch
git branch -a
```

Переключиться на ветку

```bash
git checkout ВЕТКА
```

Если необходимо переключиться на другую ветку, но некоторые файлы были изменены, то можно спрятать все изменения, которые не попали в коммиты (сохраняются только файлы, которые уже находятся в базе git):

```bash
git stash
```

Восстановить сохранённые изменения:

```bash
git stash pop
```

Изменения сохраняются в виде стека. Просмотр сохранённых снимков:

```bash
git stash list
```

Просмотр ещё не влитых изменений в ветку master:

```bash
git log --no-merges master..
```

## git push в несколько репозиториев

Создаём новый удалённый репозиторий и добавляем URL для необходимых серверов:

```bash
git remote add all gitea@MYGITSERVER:USERNAME/PROJECT
git remote set-url --add --push backup git@github.com:USERNAME/PROJECT.git
git remote set-url --add --push backup git@gitlab.com:USERNAME/PROJECT.git
git remote set-url --add --push backup git@bitbucket.org:USERNAME/PROJECT.git
```

Информация будет сохранена в текущем репозитории. Теперь можно с помощью команды git push backup пушить изменения на несколько удалённых серверов. Вместо backup можно использовать любое другое удобное имя. Репозиторий, указанный при создании backup будет использоваться только для получения информации из репозитория (например, git pull backup).

Важное замечание! Все указанные серверы воспринимаются git как единый репозиторий и будет создана метка в локальном репозитории для backup. Если вы создадите отдельную конфигурацию для одного из репозиториев, то при push в backup, метка для созданного репозитория не будет сдвигаться (чтобы сдвинуть, нужно будет сделать git push РЕПОЗИТОРИЙ, при этом может ничего не передаваться, но метка будет сдвинута).

## Удобства для работы с репозиториями

Если вы часто работаете с исходным кодом и используете Linux или любую другую систему, которая поддерживает командный интерпретатор zsh, то советую установить фреймворк, который позволит значительно упростить рутинные операции. Он позволит через командную строку ориентироваться на какой ветке git вы находитесь, в каком состоянии находится ваш репозиторий, добавляет удобные алиасы для команд git. Кроме этого, можно создать удобные хеши путей для своих проектов. Доступные алиасы команд можно узнать через команду alias. Я часто использую:

- gc = git commit -v;
- gca = git commit -v -a;
- gst = git status;
- glog = git log --oneline --decorate --graph.

Кроме этих сокращений, есть ещё огромное множество. Ознакомьтесь с ним и ваша работа заметно упростится.

В первую очередь, для установки "Oh My Zsh" необходимо установить оболочку zsh. Далее обратитесь к сайту <https://ohmyz.sh/> и [страничке wiki](https://github.com/ohmyzsh/ohmyzsh/wiki) (там указаны команды на установку фреймворка с помощью утилит curl, wget и tch). В качестве основной оболочки я, изначально, продолжал использовать bash и запускал zsh с помощью команды zsh, когда было необходимо, но, позднее, сделал её оболочкой по умолчанию.

Ввиду того, что я пишу код на разных языках, я не использую одну IDE. Обычно я храню исходный код в папках проектов IDE по умолчанию. В этом случае папка с проектами могут оказаться в разных папках домашнего каталога. ZSH позволяет создать хеши для определённых папок. В качестве хеша можно использовать имя проекта. Например, я разрабатываю проект SHCC в IDE Netbeans. В этом случае можно создать такую запись в `~/.zshrc`:

```console
hash -d shcc=/home/fsa/NetBeansProjects/shcc
```

Подобные записи я добавляю в конец файла. В этом случае, при переходе по пути `~shcc` я попадаю в домашнюю папку проекта. Кроме этого, пути до файлов сокращаются до корневой папки `~shcc`, что позволяет не только экономить место на экране, но и избавиться от лишней информации. Вы точно видите, что работаете с проектом с определённым именем, не важно по какому реальному пути, видите его состояние.

Фреймворк Oh My Zsh имеет множество встроенных тем для вашей командной строки на любой вкус, которые можно просмотреть на [Wiki странице](https://github.com/ohmyzsh/ohmyzsh/wiki/Themes). Понравившуюся тему можно установить в файле .zshrc в переменной ZSH_THEME.
