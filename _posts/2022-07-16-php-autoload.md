---
layout: post
title: Самый быстрый и простой способ автозагрузки классов в PHP
date: 2022-07-16 23:43:00 +0700
tags: [php]
excerpt: Описание самого простого и быстрого способа включить автозагрузку классов в PHP. Он не соответствует стандартам PSR, но встроен в язык PHP.
---
## Введение

Сейчас большинство серьёзных разработчиков на PHP использует composer, который предоставляет возможность включить автозагрузку классов просто используя один подключаемый файл. Однако для очень простых проектов использование composer может оказаться избыточным. Если весь ваш проект не использует внешних зависимостей и весь код написан вами, то и смысла использовать composer нет.

## Используем автозагрузку в своём минипроекте

Обычно в документации описан вариант с созданием своей функции для автозагрузки классов с использованием `spl_autoload_register()`. Она позволяет зарегистрировать функцию, которая будет заниматься автозагрузкой классов. Функций может быть зарегистрировано несколько и ни окажутся в SPL очереди. Эта функция принимает в качестве первого параметра callback метод, который будет вызываться в тех случаях, когда будет требоваться обращение к классу, который ещё не был объявлен ранее. Однако, данная функция, кроме callback, может принимать и значение null, что является значением по умолчанию. В этом случае поиск путей к необходимым классам будут производиться по путям, которые указаны в параметре конфигурации `include_path`. Значение этого параметра можно изменить с помощью функции `set_include_path()`.

Чтобы установить расширения для файлов, в которых будут храниться классы, можно использовать функцию `spl_autoload_extensions()`. В PHP 8.1 значение по умолчанию `.inc,.php`. По моему мнению, использование расширения `.inc` небезопасно, поскольку некоторые хостинги могут выдавать содержимое файлов `.inc` в виде текста, поскольку веб-сервер должен быть соответствующим образом сконфигурован для передачи данных файлов в PHP или запрета их просмотров.

Таким образом, чтобы добавить автозагрузку классов нам необходим следующий код:

```php
set_include_path(get_include_path().':'.__DIR__.'/classes/');
spl_autoload_extensions('.php');
spl_autoload_register();
```

Этот код можно ещё более сократить, поскольку вряд ли используете `include_path` в своём коде. Можно отбросить текущее значение и указать только своё.

```php
set_include_path(__DIR__.'/classes/');
spl_autoload_extensions('.php');
spl_autoload_register();
```

Путь можно ещё больше сократить исключив константу `__DIR__`, которая указывает на каталог расположения файла, где хранится этот код, но это может повлиять на корректное поведение кода в некоторых ситуациях. Используйте этот код, если действительно знаете что делаете:

```php
set_include_path('classes/');
spl_autoload_extensions('.php');
spl_autoload_register();
```

Согласно PSR-4 для обеспечения автозагрузки имена папок и файлов должны соответствовать пространствам имён (namespace) и именам классов. Однако стандартный автозагрузчик требует, чтобы все имена были переведены в нижний регистр. Т.е. если ваш класс расположен в пространстве имён `MYNS\MyClass`, то для обеспечения его автозагрузки необходимо расположить по пути, который был указан в папке `myns/myclass.php`.

```php
<?php
# myns/myclass.php
namespace MYNS;

class MyClass {
...
}
```

При желании можно указать суффикс для файлов с классами, например так:

```php
set_include_path(__DIR__.'/classes/');
spl_autoload_extensions('.class.php');
spl_autoload_register();
```

Тогда поиск класса будет производиться в файле `myns/myclass.class.php`.

## Заключение

Приведённый в заметке метод не соответствует современному стандарту PSR-4, но он имеется в стандартной поставке PHP. Его можно использовать в очень маленьких проектах, где не требуется установка зависимостей через composer. Он позволит сохранить немного тактов процессора на сервере, поскольку при автозагрузке код на PHP вообще не используется, но на современном железе и с небольшим количеством подключаемых файлов практически не даёт заметного выигрыша. Однако метод рабочий. Используйте его на свой страх и риск :)
