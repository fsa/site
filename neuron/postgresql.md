---
layout: default
title: Neuron Framework - объект PostgreSQL
excerpt: PHP фреймворк Neuron - объект PostgreSQL
---

Класс `PostgreSQL` представляет из себя дочерний класс PDO.

Получить уже готовый экземпляр класса с выполненным подключением к БД можно с помощью метода `App::sql()`. Кроме этого, можно воспользоваться методом `App::sqlCallback()` результат которого можно передать в виде callback функции. Это может быть полезно, если есть вероятность, что соединение с базой данных не понадобится. Соединение с БД будет инициализировано только в случае вызова callback функции.

## Метод insert

Метод `insert($table, $values, $index)` позволяет применить SQL запрос `INSERT INTO ...` для произвольного числа полей, значения которых находятся в массиве `$values`. Принимает на вход от двух до трёх параметров:

* `$table` - имя таблицы для вставки. ВНИМАНИЕ! Опасность SQL-инъекции. Имя таблицы не должно формироваться на основе данных пользователя, либо необходимо фильтровать полученные от пользователя данные.
* `$values` - ассоциативный массив, содержащий в ключах наименование полей таблицы, а в значениях - значения полей для вставки.
* `$index` - поле, содержащее уникальный индекс. Значение этого поля будет возвращено в случае успешной вставки. Если значение не указано, используется поле `id`.

## Метод update

Метод `update($table, $values, $index, $old_index)` позволяет выполнить SQL запрос `UPDATE ... SET ...` для произвольного числа полей, значения которых находятся в массиве `$values`. Принимает на вход от двух до четырёх параметров:

* `$table` - имя таблицы для обновления. ВНИМАНИЕ! Опасность SQL-инъекции. Имя таблицы не должно формироваться на основе данных пользователя, либо необходимо фильтровать полученные от пользователя данные.
* `$values` - ассоциативный массив, содержащий в ключах наименование полей таблицы, а в значениях - значения полей для вставки.
* `$index` - поле, содержащее уникальный индекс. Значение этого поля будет использовано в выражении `WHERE` для поиска нужной строки. Если значение не указано, используется поле `id`.
* `$old_index` - поле, содержащее старое значение первичного ключа для случаев, если при `UPDATE` значение этого ключа изменяется. Используется в выражении `WHERE` вместо значения `$index`, если указано.

## Метод fetchEntity

Метод `fetchEntity($class_name, $where)` позволяет получить объект класса `$class_name` из строки базы данных. Используемый класс должен поддерживать интерфейс `SQL\EntityInterface`. В качестве `$where` может быть использована строка или ассоциативный массив. При использовании строки, поиск строки будет производиться по первичному индексу. При использовании ассоциативного массива - по произвольным полям.

## Метод insertEntity

Метод `insertEntity($object)` позволяет добавить объект с интерфейсом `SQL\EntityInterface` в базу данных.

## Метод updateEntity

Метод `updateEntity($object, $id)` позволяет обновить данные об объекте с интерфейсом `SQL\EntityInterface` в базе данных. Значение `id` не является обязательным. Если у объекта меняется значение первичного индекса, то необходимо старое значение добавить в виде дополнительного свойства и указать имя этого свойства в `$id`.

## Метод fetchKeyPair

Метод `fetchKeyPair(string $class_name)` позволяет получить из таблицы БД с именем, которая указана в классе с интерфейсом `SQL\EntityInterface`, все строки в виде массива пар «индекс»=>«наименование». Кроме этого класс должен реализовывать интерфейс `SQL\KeyPairInterface`.

## Метод queryEntity

Метод `queryEntity($class_name, $order)` возвращает PDOStatement объект, который позволяет получить объекты класса `$class_name` из БД. Порядок записей задаётся полем `$order`, которе не является обязательным. Если значение не указано, то используется первичный индекс таблицы.
